{"ast":null,"code":"var _jsxFileName = \"E:\\\\programData\\\\React\\\\user\\\\src\\\\socket\\\\Socket.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport SocketIO from 'socket.io-client';\nimport { authService } from '@services/auth.service';\nimport { connect } from 'react-redux';\nimport { getGlobalConfig } from '@services/config';\nimport { warning, debug } from './utils';\nimport { SocketContext } from './SocketContext';\n\nclass Socket extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"socket\", void 0);\n\n    this.connect();\n  }\n\n  componentDidUpdate(nextProps) {\n    const {\n      loggedIn\n    } = this.props;\n\n    if (nextProps.loggedIn !== loggedIn) {\n      this.connect();\n    }\n\n    return true;\n  }\n\n  componentWillUnmount() {\n    this.socket && this.socket.close();\n  }\n\n  connect() {\n    const {\n      loggedIn\n    } = this.props;\n    const token = loggedIn && authService.getToken();\n\n    if (!false) {\n      return;\n    }\n\n    const config = getGlobalConfig();\n    const {\n      uri = config.NEXT_PUBLIC_SOCKET_ENDPOINT\n    } = this.props;\n    const options = {\n      transports: ['websocket', 'polling', 'long-polling'],\n      query: token ? `token=${token}` : ''\n    };\n    this.socket && this.socket.close();\n    this.socket = SocketIO(uri, this.mergeOptions(options));\n    this.socket.status = 'initialized';\n    this.socket.on('connect', () => {\n      this.socket.status = 'connected';\n      debug('connected');\n    });\n    this.socket.on('disconnect', () => {\n      this.socket.status = 'disconnected';\n      debug('disconnect');\n    });\n    this.socket.on('error', err => {\n      this.socket.status = 'failed';\n      warning('error', err);\n    });\n    this.socket.on('reconnect', data => {\n      this.socket.status = 'connected';\n      debug('reconnect', data);\n    });\n    this.socket.on('reconnect_attempt', () => {\n      debug('reconnect_attempt');\n    });\n    this.socket.on('reconnecting', () => {\n      this.socket.status = 'reconnecting';\n      debug('reconnecting');\n    });\n    this.socket.on('reconnect_failed', error => {\n      this.socket.status = 'failed';\n      warning('reconnect_failed', error);\n    });\n  }\n\n  mergeOptions(options = {}) {\n    const defaultOptions = {\n      reconnection: true,\n      reconnectionAttempts: Infinity,\n      reconnectionDelay: 1 * 1000,\n      reconnectionDelayMax: 5 * 1000,\n      autoConnect: true,\n      transports: ['websocket', 'polling', 'long-polling'],\n      rejectUnauthorized: true\n    };\n    return _objectSpread(_objectSpread({}, defaultOptions), options);\n  }\n\n  render() {\n    const {\n      children\n    } = this.props;\n    return __jsx(SocketContext.Provider, {\n      value: this.socket,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 7\n      }\n    }, React.Children.only(children));\n  }\n\n}\n\nconst mapStates = state => ({\n  loggedIn: state.auth.loggedIn\n});\n\nexport default connect(mapStates)(Socket);","map":{"version":3,"sources":["E:/programData/React/user/src/socket/Socket.tsx"],"names":["React","SocketIO","authService","connect","getGlobalConfig","warning","debug","SocketContext","Socket","Component","constructor","props","componentDidUpdate","nextProps","loggedIn","componentWillUnmount","socket","close","token","getToken","config","uri","NEXT_PUBLIC_SOCKET_ENDPOINT","options","transports","query","mergeOptions","status","on","err","data","error","defaultOptions","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","autoConnect","rejectUnauthorized","render","children","Children","only","mapStates","state","auth"],"mappings":"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","sourcesContent":["import React from 'react';\nimport SocketIO from 'socket.io-client';\nimport { authService } from '@services/auth.service';\nimport { connect } from 'react-redux';\nimport { getGlobalConfig } from '@services/config';\nimport { warning, debug } from './utils';\nimport { SocketContext } from './SocketContext';\n\ninterface ISocketProps {\n  uri?: string;\n  children: any;\n  loggedIn: boolean;\n}\n\nclass Socket extends React.Component<ISocketProps> {\n  socket;\n\n  constructor(props) {\n    super(props);\n    this.connect();\n  }\n\n  componentDidUpdate(nextProps: any) {\n    const { loggedIn } = this.props;\n    if (nextProps.loggedIn !== loggedIn) {\n      this.connect();\n    }\n    return true;\n  }\n\n  componentWillUnmount() {\n    this.socket && this.socket.close();\n  }\n\n  connect() {\n    const { loggedIn } = this.props;\n    const token = loggedIn && authService.getToken();\n    if (!process.browser) {\n      return;\n    }\n    const config = getGlobalConfig();\n    const { uri = config.NEXT_PUBLIC_SOCKET_ENDPOINT } = this.props;\n    const options = {\n      transports: ['websocket', 'polling', 'long-polling'],\n      query: token ? `token=${token}` : ''\n    };\n\n    this.socket && this.socket.close();\n\n    this.socket = SocketIO(uri, this.mergeOptions(options));\n\n    this.socket.status = 'initialized';\n\n    this.socket.on('connect', () => {\n      this.socket.status = 'connected';\n      debug('connected');\n    });\n\n    this.socket.on('disconnect', () => {\n      this.socket.status = 'disconnected';\n      debug('disconnect');\n    });\n\n    this.socket.on('error', (err) => {\n      this.socket.status = 'failed';\n      warning('error', err);\n    });\n\n    this.socket.on('reconnect', (data) => {\n      this.socket.status = 'connected';\n      debug('reconnect', data);\n    });\n\n    this.socket.on('reconnect_attempt', () => {\n      debug('reconnect_attempt');\n    });\n\n    this.socket.on('reconnecting', () => {\n      this.socket.status = 'reconnecting';\n      debug('reconnecting');\n    });\n\n    this.socket.on('reconnect_failed', (error) => {\n      this.socket.status = 'failed';\n      warning('reconnect_failed', error);\n    });\n  }\n\n  mergeOptions(options = {}) {\n    const defaultOptions = {\n      reconnection: true,\n      reconnectionAttempts: Infinity,\n      reconnectionDelay: 1 * 1000,\n      reconnectionDelayMax: 5 * 1000,\n      autoConnect: true,\n      transports: ['websocket', 'polling', 'long-polling'],\n      rejectUnauthorized: true\n    };\n    return { ...defaultOptions, ...options };\n  }\n\n  render() {\n    const { children } = this.props;\n    return (\n      <SocketContext.Provider value={this.socket}>\n        {React.Children.only(children)}\n      </SocketContext.Provider>\n    );\n  }\n}\n\nconst mapStates = (state: any) => ({\n  loggedIn: state.auth.loggedIn\n});\n\nexport default connect(mapStates)(Socket);\n"]},"metadata":{},"sourceType":"module"}